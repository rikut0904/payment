<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
</head>

<body data-skip-auth-redirect="true">
  <div class="layout">
    <%- include('../partials/header', { title, userName }) %>
      <div class="content">
        <section class="card">
          <h2>おすすめの詳細</h2>
          <div class="detail-grid">
            <div class="detail-column">
              <p><strong>ユーザー名:</strong>
                <%= entry.userName || '' %>
              </p>
              <p><strong>商品名:</strong>
                <%= entry.title || '' %>
              </p>
              <p><strong>商品概要:</strong>
                <%= entry.content || '未入力' %>
              </p>
              <p><strong>購入日:</strong>
                <%= entry.date || '未入力' %>
              </p>
              <p><strong>購入先URL:</strong>
                <% if (entry.url) { %>
                  <a href="<%= entry.url %>" target="_blank" rel="noopener noreferrer">
                    <%= entry.url %>
                  </a>
                  <% } else { %>
                    未入力
                    <% } %>
              </p>
            </div>
            <div class="detail-column">
              <p><strong>商品画像:</strong></p>
              <% if (entry.image) { %>
                <img src="/image-proxy?url=<%= encodeURIComponent(entry.image) %>" alt="商品画像" class="img-detail">
                <% } else { %>
                  未入力
                  <% } %>
            </div>
          </div>
          <div class="actions">
            <a href="/like" class="btn">一覧へ戻る</a>
            <a href="/like/update/<%= entry.id %>" class="btn edit-link">編集する</a>
          </div>
        </section>
      </div>
      <footer>
        <p>&copy; 2025 <%= projectName %>. All rights reserved.</p>
      </footer>
  </div>
  <script id="firebase-config" type="application/json"><%- JSON.stringify(firebaseConfig || {}) %></script>
  <script type="module" src="/javascripts/firebase-auth.js" defer></script>
  <script>
    document.querySelectorAll('.edit-link').forEach((link) => {
      link.addEventListener('click', async (event) => {
        event.preventDefault();
        const href = link.getAttribute('href');
        if (!href) return;
        try {
          const response = await fetch(href, {
            headers: { Accept: 'application/json' },
          });
          if (!response.ok) {
            const body = await response.json().catch(() => null);
            alert(body?.error || '編集画面を開けませんでした。');
            return;
          }
          const result = await response.json().catch(() => null);
          if (!result?.success) {
            alert(result?.error || '編集画面を開けませんでした。');
            return;
          }
          window.location.href = href;
        } catch (err) {
          alert('通信エラーが発生しました。時間をおいてから再度お試しください。');
        }
      });
    });
  </script>
</body>

</html>
